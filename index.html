<html>
<head>
    <script src="https://code.angularjs.org/2.0.0-beta.17/Rx.umd.js"></script>
    <script src="https://code.angularjs.org/2.0.0-beta.17/angular2-polyfills.js"></script>
    <script src="https://code.angularjs.org/2.0.0-beta.17/angular2-all.umd.dev.js"></script>
    <link href="jsoneditor/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
    <script src="jsoneditor/dist/jsoneditor.min.js"></script>    
    <link rel="stylesheet" type="text/css" href="styles.css">  

    <script>

        function validateJsonBody(control) {
            var s = control.value;
            try {
                JSON.parse(s);
            } catch(err) {
               return {
                validateJsonBody: {
                    valid: false
                }
               } 
            }
        }

        var JsonEditorComponent = ng.core.Component({
            selector: 'json-editor',
            template: "<div id='jsoneditor' style='width: 800px; height: 400px;'></div>"

        }).Class({
            constructor: function() {

            },
            ngOnInit : function() {
                var container = document.getElementById('jsoneditor');
                var options = {
                    mode: 'code',
                    modes: ['code', 'form', 'text', 'tree', 'view'], // allowed modes
                    onError: function (err) {
                        alert(err.toString());
                    },
                    onModeChange: function (newMode, oldMode) {
                        console.log('Mode switched from', oldMode, 'to', newMode);
                    }
                };
                this.editor = new JSONEditor(container, options);   
            },
            get : function() {
                return JSON.stringify(this.editor.get());
            }
        }); 
        
        var AppComponent = ng.core.Component({
            selector: 'company-app',
            templateUrl: 'import-form.html',
            queries: {
                editor : new ng.core.ViewChild('editor')
            }, 
            directives: [ng.common.FORM_DIRECTIVES,JsonEditorComponent],
            providers: [ng.http.HTTP_PROVIDERS]
        }).Class({
        	constructor: [ng.common.FormBuilder, ng.http.Http, function(fb, http) {
                this.model = {
                    body : '{"test" : "value"}',
                    path : '/content/web/app',
                    verisons: ["current store", "X store"],
                    selectedVersion : "X store"
                };

                this.fb = fb;
                this.http = http;

            }],
            ngOnInit: function() {
                this.inputJsonForm = this.fb.group({
                    'body' : new ng.common.Control("", validateJsonBody),
                    'version' : [],
                    'path': ['/content/web', ng.common.Validators.required]
                });

            },
            doImport : function(value) {
                console.log(this.editor.get());
                return false;
            }
        });

        document.addEventListener("DOMContentLoaded", function() {
            ng.platform.browser.bootstrap(AppComponent, [ ng.http.HTTP_PROVIDERS ]);
        });

    </script>

</head>
<body>
    <company-app>
        Loading ...
    </company-app>
</body>
</html>
