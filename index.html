<html>
<head>
    <!-- 1. Load libraries -->
    <!-- IE required polyfill -->
    <script src="https://npmcdn.com/core-js/client/shim.min.js"></script>
    <script src="https://npmcdn.com/zone.js@0.6.12?main=browser"></script>
    <script src="https://npmcdn.com/reflect-metadata@0.1.3"></script>
    <script src="https://npmcdn.com/rxjs@5.0.0-beta.6/bundles/Rx.umd.js"></script>
    <script src="https://npmcdn.com/@angular/core/bundles/core.umd.js"></script>
    <script src="https://npmcdn.com/@angular/common/bundles/common.umd.js"></script>
    <script src="https://npmcdn.com/@angular/http/bundles/http.umd.js"></script>
    <script src="https://npmcdn.com/@angular/compiler/bundles/compiler.umd.js"></script>
    <script src="https://npmcdn.com/@angular/platform-browser/bundles/platform-browser.umd.js"></script>
    <script src="https://npmcdn.com/@angular/platform-browser-dynamic/bundles/platform-browser-dynamic.umd.js"></script>

    <link href="jsoneditor/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
    <script src="jsoneditor/dist/jsoneditor.min.js"></script>    
    <link rel="stylesheet" type="text/css" href="styles.css">  

    <script>
    (function(app) {
        function validateJsonBody(control) {
            var s = control.value;
            try {
                JSON.parse(s);
            } catch(err) {
               return {
                validateJsonBody: {
                    valid: false
                }
               } 
            }
        }

        var JsonEditorComponent = ng.core.Component({
            selector: 'json-editor',
            template: "<div #jsoneditor id='jsoneditor' style='width: 800px; height: 400px;'></div>",
            queries: {
                jsoneditor: new ng.core.ViewChild('jsoneditor')
            }

        }).Class({
            constructor: function() {

            },
            ngOnInit : function() {
                var options = {
                    mode: 'code',
                    modes: ['code', 'form', 'text', 'tree', 'view'], // allowed modes
                    onError: function (err) {
                        alert(err.toString());
                    },
                    onModeChange: function (newMode, oldMode) {
                        console.log('Mode switched from', oldMode, 'to', newMode);
                    }
                };
                this.editor = new JSONEditor(this.jsoneditor.nativeElement, options);   
            },
            get : function() {
                return JSON.stringify(this.editor.get());
            }
        }); 
        
        var AppComponent = ng.core.Component({
            selector: 'company-app',
            templateUrl: 'import-form.html',
            queries: {
                editor : new ng.core.ViewChild('editor')
            }, 
            directives: [ng.common.FORM_DIRECTIVES,JsonEditorComponent],
            providers: [ng.http.HTTP_PROVIDERS]
        }).Class({
        	constructor: [ng.common.FormBuilder, ng.http.Http, function(fb, http) {
                this.model = {
                    body : '{"test" : "value"}',
                    path : '/content/web/app',
                    verisons: ["current store", "X store"],
                    selectedVersion : "X store"
                };

                this.fb = fb;
                this.http = http;

            }],
            ngOnInit: function() {
                this.inputJsonForm = this.fb.group({
                    'body' : new ng.common.Control("", validateJsonBody),
                    'version' : [],
                    'path': ['/content/web', ng.common.Validators.required]
                });

            },
            doImport : function(value) {
                console.log(this.editor.get());
                return false;
            }
        });

        document.addEventListener("DOMContentLoaded", function() {
           ng.platformBrowserDynamic.bootstrap(AppComponent, [ ng.http.HTTP_PROVIDERS ]);
        });
    })(window.app || (window.app = {}));
    </script>

</head>
<body>
    <company-app>
        Loading ...
    </company-app>
</body>
</html>
